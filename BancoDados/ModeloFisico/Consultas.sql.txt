-- Baixa Complexidade --
-- Consulta todos os produtos cadastrados
SELECT * FROM CTL_ESTOQUE.PRODUTO p;

-- Consulta todos as cidades cadastradas do estado do paraná
SELECT * 
FROM CTL_ESTOQUE.MUNICIPIO m
WHERE UPPER(m.NM_ESTADO) = 'PARANÁ';

-- Consulta todos as transações que ocorreram no ano de 2024
SELECT * 
FROM CTL_ESTOQUE.TRANSACAO t 
WHERE DT_TRANSACAO >= TO_DATE('01/01/2024', 'DD/MM/YYYY')

-- Média Complexidade --
-- Consulta todos os produtos em estoquue, mostrando o nome, descrição e embalagem do produto
SELECT pe.*, P.NM_PRODUTO, P.DS_PRODUTO, P.TP_EMBALAGEMPRODUTO 
FROM CTL_ESTOQUE.PRODUTO_ESTOQUE pe
JOIN CTL_ESTOQUE.PRODUTO p ON pe.CD_PRODUTO = p.CD_PRODUTO

-- Consulta todaos os clientes e fornecedores
SELECT *
FROM CTL_ESTOQUE.PESSOA p 
LEFT JOIN CTL_ESTOQUE.CLIENTE c    ON P.CD_PESSOA = C.CD_CLIENTE 
LEFT JOIN CTL_ESTOQUE.FORNECEDOR f ON P.CD_PESSOA = F.CD_FORNECEDOR;

-- Consulta o endereço de todos os clientes
SELECT 
  P.NM_PESSOA, 
  E.NR_CEP, 
  E.NM_LOGRADOURO, 
  E.NR_ENDERECO, 
  E.NM_BAIRRO, 
  M.NM_MUNICIPIO, 
  M.NM_ESTADO, 
  M.NM_PAIS 
FROM CTL_ESTOQUE.PESSOA p 
JOIN CTL_ESTOQUE.ENDERECO e ON P.CD_ENDERECO = E.CD_ENDERECO 
JOIN CTL_ESTOQUE.MUNICIPIO m ON E.CD_MUNICIPIO  = M.CD_MUNICIPIO
JOIN CTL_ESTOQUE.CLIENTE c ON P.CD_PESSOA = C.CD_CLIENTE;


-- Alta Complexidade --
-- Consulta o ranking de fornecedores que fornecem mais produtos
SELECT 
  P.NM_PESSOA, 
  F.NR_CNPJ,
  COUNT(PF.CD_FORNECEDOR) 
FROM CTL_ESTOQUE.PRODUTO_FONECEDOR pf 
JOIN CTL_ESTOQUE.FORNECEDOR f  ON PF.CD_FORNECEDOR = F.CD_FORNECEDOR
JOIN CTL_ESTOQUE.PESSOA p      ON F.CD_FORNECEDOR  = P.CD_PESSOA 
GROUP BY   
  P.NM_PESSOA, 
  F.NR_CNPJ,
ORDER BY COUNT(PF.CD_FORNECEDOR);

-- Consulta os dados do forncedor em que mais são realizados compras
SELECT 
  F.CD_FORNECEDOR,
  P.NM_PESSOA,
  P.NR_TELEFONE,
  P.NM_EMAIL,
  F.NR_CNPJ,
  E.NM_LOGRADOURO || ', ' || E.NR_ENDERECO || ', ' || E.NM_BAIRRO || ' - ' || M.NM_MUNICIPIO || ' - ' ||M.NM_ESTADO ENDERECO_COMPLETO,
FROM CTL_ESTOQUE.PESSOA p
JOIN CTL_ESTOQUE.FORNECEDOR f ON P.CD_PESSOA    = F.CD_FORNECEDOR
JOIN CTL_ESTOQUE.ENDERECO e   ON P.CD_ENDERECO  = E.CD_ENDERECO
JOIN CTL_ESTOQUE.MUNICIPIO m  ON E.CD_MUNICIPIO = M.CD_MUNICIPIO 
WHERE F.CD_FORNECEDOR = (SELECT MAX(QT_PEDIDOS), CD_FORNECEDOR
						  FROM (SELECT COUNT(PED.CD_PESSOA) QT_PEDIDOS, PED.CD_PESSOA CD_FORNECEDOR
							    FROM CTL_ESTOQUE.PRODUTO_PEDIDO pped  
							    JOIN CTL_ESTOQUE.PEDIDO ped ON PPED.CD_PEDIDO = PED.CD_PEDIDO
							    WHERE PED.TP_PEDIDO = 'C'
							    GROUP BY PED.CD_PESSOA)
						  GROUP BY CD_FORNECEDOR)

-- Consulta todos os produtos no estoque do fornecedor 10
SELECT DISTINCT 
  P.CD_PRODUTO,
  P.NM_PRODUTO,
  PE.QT_PRODUTOESTOQUE
FROM CTL_ESTOQUE.PRODUTO_ESTOQUE pe 
JOIN CTL_ESTOQUE.PRODUTO p 
WHERE CD_PRODUTO IN (SELECT CD_PRODUTO
					 FROM CTL_ESTOQUE.PRODUTO_FONECEDOR pf
					 WHERE PF.CD_FORNECEDOR = 10);

-- Consulta o endereço todos os clientes da cidade de São Paulo, que possuem mais de 10 pedidos
SELECT
  PED.CD_PEDIDO,
  PES.NM_PESSOA, 
  E.NR_CEP, 
  E.NM_LOGRADOURO, 
  E.NR_ENDERECO, 
  E.NM_BAIRRO, 
  M.NM_MUNICIPIO, 
  M.NM_ESTADO, 
  M.NM_PAIS,
  COUNT(1) 
FROM CTL_ESTOQUE.PEDIDO ped  
JOIN CTL_ESTOQUE.PESSOA pes ON ped.CD_PESSOA  = pes.CD_PESSOA
JOIN CTL_ESTOQUE.ENDERECO e ON pes.CD_ENDERECO = E.CD_ENDERECO 
JOIN CTL_ESTOQUE.MUNICIPIO m ON E.CD_MUNICIPIO  = M.CD_MUNICIPIO
WHERE M.NM_MUNICIPIO = 'São Paulo'
  AND PED.TP_PEDIDO = 'V'
GROUP BY 
  PED.CD_PEDIDO,
  PES.NM_PESSOA, 
  E.NR_CEP, 
  E.NM_LOGRADOURO, 
  E.NR_ENDERECO, 
  E.NM_BAIRRO, 
  M.NM_MUNICIPIO, 
  M.NM_ESTADO, 
  M.NM_PAIS,
HAVING COUNT(1) > 10;